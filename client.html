<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<head>
<title>WebSocket</title>

<style>
 html,body{
   font:normal 0.9em arial,helvetica;
   position: absolute;
   top: 10%;
   left: 50%;}

 #log {width:440px; height:200px; border:1px solid #7F9DB9; overflow:auto;}

 #msg {width:330px;}

</style>
</head>


<body onload="init()">
 <h3>WebSocket v2.00</h3>
 <div id="log"></div>
 <br><br>
       Quelle competence choisissez-vous ?
      <br><br>
      <select id="metier">
        <option value="carl">Carleur</option>
        <option value="cuis">Cuisinier</option>
        <option value="elec">Electricien</option>
        <option value="jard">Jardinier</option>
        <option value="mena">Menage</option>
        <option value="plom">Plombier</option>
        <option value="prom">Promenade</option>
      </select>
      <br><br>

      Quelle ville voulez-vous ?
      <br><br>
        <input type="text" id="ville" size="15">
      <br><br>

      Quel creneau choisissez-vous ?

      <ul id="l"><li>
        Debut : <input type="time" id="startTime">
        Fin : <input type="time" id="endTime">
       <input id="date" type="date">
       </li></ul>
      <ul id="p"></ul>

      <button onclick="clone()">Plus de creneaux ?</button>

      <br><br>
      Choisissez un type de requete :
       <br><br>
        <select id="requete">
          <option>Rechercher</option>
          <option>Deposer</option>
        </select>
       <br><br>

     <br><br>
     <button type="button" id="dmdbut" onclick="sendreq()">Soumettre</button>
     <!--<input type="submit" value="Valider" onblur="senddmd()" />-->


 <br><br>
 <button id="quit" onclick="quit()">Quitter</button>

 <script>
 var socket;
 var tabid = new Array();

//initialisation co
 function init(){
   var host = "ws://localhost:12345";
   try{
     socket = new WebSocket(host);
     log('WebSocket - status '+socket.readyState);
     socket.onopen    = function(msg){ log("Welcome - status "+this.readyState); };
     socket.onmessage = function(msg){ log("Received: "+msg.data); };
     socket.onclose   = function(msg){ log("Disconnected - status "+this.readyState); };
   }
   catch(ex){ log(ex); }
 }

 function clone(){

     var itm = document.getElementById("l").lastChild;
     var cln = itm.cloneNode(true);
     cln.id = Math.floor(Math.random() * Math.floor(max));
     tabid.lastChild = cln.id;
     document.getElementById("p").appendChild(cln);
 }

function recop(item, index){
 var creneausup = "";
 creneausup = creneausup + " " + item;
return creneausup;
}

//sendreq
 function sendreq(){
   var msg;
   var x = document.getElementById("metier").selectedIndex;
   var y = document.getElementById("metier").options;
   var a = document.getElementById("startTime").value;
   var b = document.getElementById("endTime").value;
   var Rdate = document.getElementById("date").value;
   var d = document.getElementById("requete").selectedIndex;
   var e = document.getElementById("requete").options;
   var Rvil = document.getElementById("ville").value;


  if (e[d].index==0){
    msg = "DMD " + a + " " + b + tabid.foreach(recop) + " " + Rdate + " " + y[x].value + " " +  Rvil;
    if(!msg){ alert("Le message n'est pas conforme [vide]."); return; }
    //try{ socket.send(msg); log('Votre requête: '+msg); } catch(ex){ log(ex); }
    try{log('Votre requete: ' + msg);} catch(ex){ log(ex); }
  }
  else {
   msg = "CPT " +  + " " + Rdate + " " + y[x].value + " " +  Rvil;
    if(!msg){ alert("Le message n'est pas conforme [vide]."); return; }
    //try{ socket.send(msg); log('Votre requête: '+msg); } catch(ex){ log(ex); }
    try{log('Votre requete: ' + msg);} catch(ex){ log(ex); }
  }
}

 //quitter
 function quit(){
   log("Goodbye!");
   socket.close();
   socket=null;
 }

 // Utilities
 function $(id){ return document.getElementById(id); }
 function log(msg){ $("log").innerHTML+="<br>"+msg; }
 function onkey(event){ if(event.keyCode==13){ send(); } }
 </script>


</body>
</html>
